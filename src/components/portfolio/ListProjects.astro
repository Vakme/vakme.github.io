---
import Project from "./Project.astro";
import Heading from "../ui/Heading.astro";
import { Icon } from "astro-icon/components";
import {postListSchema} from "../blog/post.types.ts";

const response = await fetch("https://dev.to/api/articles?username=vakme");
const body = await response.json();
const parsedResponse = postListSchema.safeParse(body);
const data = parsedResponse.success ? parsedResponse.data : [];
const allPosts = [...data];
---

<section
  class="bg-linear-to-t dark:from-[#0e0e10] from-white from-50% to-transparent to-100% scroll-m-16 relative pt-8 pb-32 max-2xl:px-8 max-md:pt-4"
  id="projects"
>
  <div class="mx-auto max-w-7xl py-8">
    <div class="flex gap-4 items-center justify-center text-center">
      <Icon class="text-3xl dark:text-white text-blacktext" name="dashboard" />
      <Heading text="Knowledge" textGradient="Sharing" level={2} />
    </div>
    <slot />
  </div>

  <div
    id="containerProjects"
    class="mx-auto max-w-7xl grid grid-cols-3 max-lg:grid-cols-2 max-md:grid-cols-1 gap-5 p-2 py-4 max-h-[150vh] overflow-hidden transition-[max-height] duration-500 ease-in-out"
  >
    {
      allPosts.map((post) => (
        <Project
          url={post.url}
          title={post.title}
          description={post.description}
          date={post.published_at}
          languages={post.tag_list}
          source={post.source}
          image={{
              url: post.social_image,
              alt: post.title,
          }}
        />
      ))
    }
  </div>

    {allPosts.length > 3 && (
            <div
            id="moreProjects"
            class="absolute bottom-0 left-0 w-full flex justify-center text-center bg-linear-to-t from-[#FBFEFD] dark:from-[#0e0e10] from-55% to-transparent to-100% pb-30 pt-52"
    >
        <button
                class="absolute font-bold cursor-pointer text-mint-400 dark:text-mint-100 hover:text-mint-500 dark:hover:text-mint-300 transition-all"
        >
            View More Projects...
        </button>
    </div>)}
</section>

<script>
  document.querySelector("#moreProjects")?.addEventListener("click", () => {
    const container = document.querySelector("#containerProjects");
    const moreProjectsBtn = document.querySelector("#moreProjects");

    if (container && moreProjectsBtn) {
      // Expand container to show all projects
      container.classList.remove("h-[150vh]");
      container.classList.remove("h-auto");
      // Hide the "View More" button after animation completes
      moreProjectsBtn.classList.add("hidden");
      setTimeout(() => {
        moreProjectsBtn.classList.add("hidden");
      }, 500);
    }
  });
</script>
